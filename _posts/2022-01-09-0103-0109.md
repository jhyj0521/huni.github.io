---
title: "0103 - 0109"
tag: TIL
category: TIL
excerpt: ""
---

## 0103

# 이벤트 루프

최근에 비동기를 다시 한 번 공부하면서 부족했던 개념들을 채우게 되었다.  
이에 대한 내용을 정리해보고자 한다.

## 이벤트 루프란?

- 브라우저 메인 스레드 동작 타이밍을 관리하는 기능이다.
- 메인 스레드란 JS 코드 실행이나 브라우저 렌더링을 맡는 등 브라우저의 주된 동작이 수행되는 곳이다.

1. 브라우저 동작 대부분은 메인 스레드에서 싱글 스레드로 실행된다.

- 비동기 함수들을 제외한 대부분의 코드는 메인 스레드라는 곳에서 실행된다.
- 또한 브라우저 화면을 그리는 렌더링 작업도 이곳에서 실행된다.
- 메인 스레드가 싱글 스레드로 동작하는 것이 중요한 이유는 하나의 작업을 하고 있다면 다른 작업을 지연시키기 때문이다.
- 즉, 메인 스레드에서 블로킹이 발생하면 브라우저는 먹통이 되는 현상이 발생한다. 사용자 이벤트도 메인 스레드에서 동작하기 때문에 키보드 입력이나 마우스 클릭도 동작하지 않는다.

2. 메인 스레드는 이벤트 루프에 의해 관리된다.

- 메인 스레드와 같이 싱글 스레드에서 하나의 작업이 오랫동안 실행되어서도 안 되고, 여러 작업 중 어떤 작업을 우선으로 동작시킬 것인가를 결정하는 것도 매우 중요하다.
- 또한 작업 간 전환 속도를 빠르게 하여 한 번에 하나의 작업씩 수행하지만 마치 동시에 수행하는 것처럼 동작해야 한다.
- 이러한 컨트롤을 이벤트 루프가 해주기에 이를 정확히 이해하는 것이 중요하다.

### 이벤트 루프의 우선순위

1. 초기 콜스택에 쌓여있는 작업을 모두 처리한다.
2. Promise.then 콜백이 마이크로태스크 큐에 등록되어 있다면 실행
   - 모든 콜백이 처리될 때까지 계속 수행한다.
3. 화면 갱신이 필요하다면 렌더링 파이프라인으로 이동
   - 사용자가 스크롤 이동을 했거나, 어떤 요소를 클릭했거나 등등 화면을 갱신할 필요가 있을 때
   - **requestAnimationFrame**을 사용하면 이벤트 루프가 모니터 주사율에 맞춰 렌더링 파이프라인으로 들어가려고 노력한다.
4. 태스크 큐에 있는 콜백을 하나씩 실행

### requestAnimationFrame vs setTimeout

- rAF와 setTimeout의 가장 큰 차이점은 1프레임 당 호출이 보장되느냐 않느냐에 차이가 있다.
- rAF는 렌더링 파이프라인과 붙어 동작하기 때문에 1프레임 당 1번의 호출이 보장되는 반면, setTimeout은 지연되어 버벅거리는 애니메이션을 제공할 수 있다.

> **reference**  
> [이벤트 루프, 넌 누구냐](https://tecoble.techcourse.co.kr/post/2021-08-28-event-loop/)
