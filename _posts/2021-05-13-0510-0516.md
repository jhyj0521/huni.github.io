---
title: "0510-0516"
tag: TIL
category: TIL
---
## 0510
# 회원 이름 쿠키에서 jwt 정보로 넣기 - 프론트


```javascript
/* eslint-disable no-unused-vars */
import memberService from "@/api/member";
import { getAuthFromCookie, deleteCookie } from "@/utils/cookies";

export const member = {
  state: {
    token: getAuthFromCookie() || "",
    memberName: "",
    memberNo: ""
  },
  getters: {
    isLogin(state) {
      return state.token !== "";
    }
  },
  actions: {
    async register({ commit }, member) {
      const result = await memberService.register(member);
      console.log(result);
    },
    async login({ commit }, member) {
      const result = await memberService.login(member);
      commit("setToken", getAuthFromCookie());
      return result;
    },
    async getJwtInfo({ commit }) {
      const result = await memberService.getJwtInfo();
      commit("setMemberNo", result.data.data.memberNo);
      commit("setMemberName", result.data.data.memberName);
    }
  },
  mutations: {
    setToken(state, token) {
      state.token = token;
    },
    setMemberName(state, memberName) {
      state.memberName = memberName;
    },
    setMemberNo(state, memberNo) {
      state.memberNo = memberNo;
    },
    logout(state) {
      state.token = "";
      deleteCookie("jwt");
    }
  }
};
```
* state의 memberName 기본값을 쿠키에서 가져오는 것이 아니라 빈 문자열로 수정하였다.
* getJwtInfo action에 api 결과로 받아온 memberName을 commit하는 코드를 추가하였다.
* getJwtInfo 메소드를 로그인, 회원가입 페이지를 제외하고 모든 페이지에서 실행시켜서 정보를 이용해 페이지를 구성할 수 있도록 구현했다.


## 0511
# 토큰 유효 기간 만료 시 alert 창 2회 호출 수정 및 기본 페이지 변경
토큰이 만료 되었을 때, api 인터셉터 catch 문에서 alert 메시지를 띄우게 되면 페이지를 열 때 기본으로 호출하는 메소드의 개수에 따라서 alert 창이 나타나서 이 오류를 수정하였다.

```javascript
// api/member.js

import { axiosService, axiosServiceWithAuth } from "./index";
import { deleteCookie } from "../utils/cookies";

const register = async data => {
  return await axiosService.post("members/new", data);
};

const login = async data => {
  return await axiosService.post("members/login", data, {
    withCredentials: true
  });
};

const getJwtInfo = async () => {
  try {
    return await axiosServiceWithAuth.post("jwt");
  } catch (error) {
    if (error.response.status === 401) {
      deleteCookie("jwt");
      alert("접속이 종료 되었습니다. 다시 로그인 하세요.");
      location.replace("/login");
    }
  }
};

export default { register, login, getJwtInfo };
```
* api 폴더 안에 있는 모든 메소드를 async로 변경하고, getJwtInfo 메소드는 로그인과 회원가입을 제외한 모든 페이지에서 호출되므로 try catch 문으로 status가 401이면 쿠키를 삭제하고, alert 창을 띄운 후 로그인 페이지로 이동하는 로직을 구현하였다.
* 그리고 라우터에서 /main 페이지를 기본페이지로 설정하여 권한이 필요한 페이지들에서는 페이지를 열기전에 jwt 쿠키가 없다면 login 페이지로 이동하도록 로직을 설정하여 논리적으로 페이지간의 이동이 올바르게 수정하였다.

## 0512
# 404 NotFound 페이지 생성
잘못된 url로 접근했을 때, 잘못된 요청임을 알려주는 페이지를 생성하였다.

```javascript
const routes = [
  {
    path: "*",
    component: () => import("@/views/NotFoundPage.vue")
  }
];
```
* 우선 router에서 위와 같이 설정을 하면, 내가 지정해 둔 페이지 url 외에 다른 방식으로 접근하였을 때, NotFoundPage 컴포넌트를 화면에 노출시킨다.

```vue
<template>
  <div class="content_mainBox">
    <div class="error_message">페이지를 찾을 수 없습니다.</div>
    <button class="btn_basic" @click="routeMain">홈페이지 이동</button>
  </div>
</template>
<script>
export default {
  methods: {
    routeMain() {
      this.$router.push("/main");
    }
  }
};
</script>

<style scoped src="@/assets/css/notFoundPage.css"></style>
```
* NotFoundPage는 위와 같이 간단한 메시지와 함께 홈페이지로 이동하는 버튼을 화면에 표시하였다.