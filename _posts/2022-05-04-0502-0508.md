---
title: "0502 - 0508"
tag: TIL
category: TIL
excerpt: ""
---

## 0502

# 국제화, 내용 협상, 웹 호스팅, 부하 균형

## 국제화

HTTP에서 엔터티 본문이란 그저 비트들로 가득 찬 상자에 불과하다.  
국제 콘텐츠를 지원하기 위해, 서버는 클라이언트에게 각 문서의 문자와 언어를 알려줘서, 사용자에게 콘텐츠를 제공해줄 수 있도록 할 필요가 있다.

서버는 클라이언트에게 문서의 문자와 언어를 Content-Language 헤더를 통해 알려준다.

### 문자 집합과 HTTP

- charset 태그는 비트들을 글자들로 변환하거나 혹은 그 반대의 일을 해주는 알고리즘을 명명한다.
- 문서를 이루는 비트들은, 특정 코딩된 문자집합의 특정 문자로 식별될 수 있는 문자 코드로 변환된다. 문자 코드는 코딩된 문자집합의 특정 요소를 선택하기 위해 사용된다.
- 잘못된 charset 매개변수를 사용하면, 클라이언트는 이상한 깨진 글자를 보여주게 된다.
- 문자 집합이 명시적으로 나열되지 않았다면, 수신자는 문서의 콘텐츠로부터 문서집합을 추측하려 시도한다. HTML에서는 메타 태그가 이에 해당한다.
- 클라이언트는 서버에게 그들이 어떤 문자 체계를 지원하는지 Accept-Charset 요청 헤더를 통해 알려준다.

## 내용 협상과 트랜스코딩

### 클라이언트 주도 협상

클라이언트가 요청을 보내면 서버는 클라이언트에게 선택지를 보내주고, 클라이언트가 선택한다.  
서버 입장에서는 가장 구현하기 쉽지만, 대기시간이 증가한다는 단점이 존재한다.

### 서버 주도 협상

서버가 클라이언트 요청 Accept 헤더를 검증해서 어떤 버전을 제공할지 결정한다.  
HTTP 프로토콜은 클라이언트가 각 선호의 카테고리마다 여러 선택 가능한 항목을 선호도와 함께 나열할 수 있도록 품질값을 정의하였다.  
품질값(q)은 0.0부터 1.0까지 가질 수 있다. 0.0이 가장 낮은 선호도, 1.0이 가장 높은 선호도를 의미한다.

### 투명 협상

클라이언트 입장에서 협상하는 중개자 프락시를 둠으로써 클라이언트와의 메시지 교환을 최소화하는 동시에 서버 주도 협상으로 인한 부하를 서버에서 제고한다.

### 트랜스 코딩

서버가 클라이언트의 요구에 맞는 문서를 아예 갖고 있지 않은 경우 서버는 기존의 문서를 클라이언트가 사용할 수 있는 무언가로 변환할 수 있는데, 이 옵션을 트랜스 코딩이라고 한다.

- 포맷 변환 - 데이터를 클라이언트가 볼 수 있도록 한 포맷에서 다른 포맷으로 변환한다.
- 정보 합성 - 문서에서 정보의 요점을 추출한다.
- 콘텐츠 주입 - 오히려 양을 늘리는 또 다른 종류의 변환인 내용 주입 트랜스코딩이다.

## 가상 호스팅

많은 웹 호스팅 업자는 컴퓨터 한 대를 여러 고객이 공유하게 해서 저렴한 웹 호스팅 서비스를 제공한다. 이를 공유 호스팅 혹은 가상 호스팅이라 부른다.  
각 웹 사이트는 다른 서버에서 호스팅하는 것처럼 보이겠지만, 물리적으로 같은 서버에서 호스팅되는 것이다.  
호스팅 업자는 복제 서버 더미(서버 팜)를 만들고 서버 팜에 부하를 분산할 수 있다. 팜에 있는 각 서버는 다른 서버를 복제한 것이며, 수많은 가상 웹 사이트를 호스팅하고 있기 때문에 관리자는 훨씬 편해진다.

### 가상호스팅 동작하게 하기

- URL 경로를 통한 가상 호스팅 - 서버가 어떤 사이트를 요청하는 것인지 알 수 있게 URL에 특별한 경로 컴포넌트를 추가한다. (좋지 않은 방법)
- 포트번호를 통한 가상 호스팅 - 각 사이트에 다른 포트번호를 할당하여, 분리된 웹 서버의 인스턴스가 요청을 처리한다. (좋지 않은 방법)
- IP 주소를 통한 가상 호스팅 - 각 가상 사이트에 별도의 IP 주소를 할당하고 모든 IP 주소를 장비 하나에 연결한다. (문제가 있지만 위의 두 방법보다는 좋은 방법)
- HOST 헤더를 통한 가상 호스팅 - 웹 서버는 Host 헤더로 가상 사이트를 식별할 수 있다. (가장 좋은 방법)

## 리다이렉션과 부하 균형

HTTP 애플리케이션은 세 가지를 원한다.

- 신뢰할 수 있는 HTTP 트랜잭션의 수행
- 지연 최소화
- 네트워크 대역폭 절약

이러한 이유 때문에 웹 콘텐츠는 여러 장소에 배포된다. 이렇게 하면 한 곳에 실패한 경우 다른 곳을 이용할 수 있으므로 신뢰성이 개선된다.  
또한 클라이언트가 보다 가까운 리소스에 접근할 수 있게 되어 응답시간도 줄여준다.  
그리고 목적지 서버가 분산되므로 네트워크 혼잡도 줄어든다.

-> 리다이렉션이란 최적의 분산된 콘텐츠를 찾는 것을 도와주는 기법을 의미한다.

대부분의 리다이렉션 장치들은 몇 가지 방식의 부하 균형을 포함한다. 즉, 들어오는 메시지의 부하를 서버들의 집합에게 분산할 수 있다.

### HTTP 리다이렉션

몇몇 웹 사이트는 HTTP 리다이렉트 메시지를 이용해 부하를 분산한다.  
요청을 처리하는 서버(리다이렉팅 서버)는 가용한 것들 중 부하가 가장 적은 콘텐츠 서버를 찾아서 브라우저의 요청을 그 서버로 리다이렉트 한다.

**장점**  
리다이렉트를 하는 서버가 클라이언트의 아이피 주소를 알기 때문에 좀 더 정보에 근거해 선택할 수 있다.

**단점**

- 어떤 서버로 리다이렉트할 지 결정하려면 원 서버는 상당히 많은 처리를 해야 한다.
- 페이지에 접근할 때마다 두 번의 왕복이 필요하기 때문에, 대기 시간이 길어진다.
- 리다이렉트 서버가 고장나면, 사이트도 고장난다.

### DNS 리다이렉션

DNS는 하나의 도메인에 여러 아이피 주소가 결부되는 것을 허용하며, DNS 분석자는 여러 아이피 주소를 반환하도록 설정되거나 프로그래밍 될 수 있다.

분석자가 어떤 아이피 주소를 반환할 것인가를 결정하는 방법은 단순한 것부터 복잡한 것까지 다양하다. 가장 쉬운 DNS 결정 알고리즘은 단순한 라운드 로빈이다.

**라운드 로빈**  
서버에 대한 클라이언트의 상대적인 위치나 서버의 현재 스트레스를 고려하지 않는다.  
부하 균형을 위해, DNS 서버는 룩업이 끝났을 때마다 주소를 순환시킨다.  
쉽게 말해서, 부하를 순환시켜 돌아가면서 서버를 배정하는 것이다.  
-> 완벽하지는 않은 방법

몇몇 향상된 DNS 서버는 주소의 순서를 결정하기 위해 다른 기법을 사용한다.

**부하 균형 알고리즘**  
웹 서버의 로드를 추적하고 가장 로드가 적은 웹 서버를 목록의 가장 위에 놓는다.

**근접 라우팅 알고리즘**  
근처의 웹 서버로 보내는 시도를 한다.

**결함 마스킹 알고리즘**  
DNS 서버는 네트워크의 상태를 모니터링하여 장애를 피해서 라우팅한다.
