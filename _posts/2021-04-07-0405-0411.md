---
title: "0405-0411"
tag: TIL
category: TIL
---
## 0405
# CORS 이슈

API 서버를 1차 완성시키고 프론트엔드 서버에서 API를 호출하여 제대로 콘솔에 나타내는지 테스트를 진행하였다.
그 결과 아래와 같은 오류가 발생하였다.

> Access to XMLHttpRequest at 'http://localhost:8080/boards/lists' from origin 'http://localhost:3000' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource.


해석해보면 CORS 정책을 위반했기 때문에 발생하는 오류라는 것을 알 수 있다.

### CORS
* CORS는 Cross-Origin Resource Sharing의 줄임말로, 한국어로 직역하면 교차 출처 리소스 공유라고 해석할 수 있다.  
* 여기서 Origin은 protocol, host, port number을 합친 것을 의미한다.
* 결국 다른 출처로 리소스를 요청해서 사용하기 위해서는 CORS 정책을 지켜야만 했다.

## 해결책
전역적으로 적용하기 위해 WebConfig 클래스에 addCorsMappings 메소드를 오버라이딩 하여 설정하였다.

```java
@Override
public void addCorsMappings(CorsRegistry registry) {
    // 모든 uri에 대해 http://localhost:3000의 접근을 허용한다.
    registry.addMapping("/**")
            .allowedOrigins("http://localhost:3000");
}
```

## 0406
# register 함수를 실행하여 api 통신 테스트
*구조화를 시키고 제대로 프론트엔드 개발에 들어가기 전에 api를 호출하였을 때 제대로 데이터가 응답되는지 테스트하기 위해 기본적인 회원가입 api를 테스트하였다.*

```vue
<!-- SignupFrom.vue -->
<template>
  <div class="main_loginBox">
    <input
      type="text"
      class="login_id"
      placeholder="아이디"
      v-model="member.memberId"
    />
    <input
      type="text"
      class="login_name"
      placeholder="이름"
      v-model="member.memberName"
    />
    <input
      type="password"
      class="login_pw"
      placeholder="비밀번호"
      v-model="member.password"
    />
    <input type="password" class="login_pw" placeholder="비밀번호 확인" />
    <button class="btn_signup" @click="signupMethod">회원가입</button>
  </div>
</template>

<script>
export default {
  data() {
    return {
      member: {
        memberId: "",
        memberName: "",
        password: ""
      }
    };
  },
  methods: {
    async signupMethod() {
      const result = await this.$store.dispatch("register", this.member);

      console.log(result);
    }
  }
};
</script>

<style scoped src="../../assets/css/member/form.css"></style>
```
* member 객체의 속성을 memberId, memberName, password에 매치시켜서 저장하여 회원가입 버튼 클릭 시 store에 있는 register 메소드를 실행시키도록 하였다.

```javascript
// member-module.js
/* eslint-disable no-unused-vars */
import memberService from "../service/memberService";

export const member = {
  state: {},
  actions: {
    async register({ commit }, member) {
      try {
        const result = await memberService.register(member);
        console.log(result);
      } catch (error) {
        console.log(error.response);
      }
    }
  }
};
```
* axios는 비동기 통신이므로 actions에 선언하여 try catch문으로 처리하였다.
* `{ commit }`을 작성하고 사용하지 않는 경우에는 에러가 발생하는 데, 에러를 발생시키지 않기 위해 2번 째 줄에 주석을 작성하였다.
* `console.log(error.response);`를 통해서 에러 시에도 정상적으로 데이터가 반환되도록 하였다.

```javascript
// memberService.js
import axios from "axios";

const register = member => {
  console.log(member);
  const url = "http://localhost:8080/members/new";
  return axios.post(url, member);
};

export default { register };
```
* api를 호출하는 로직은 모두 한 곳에 모아두기 위해서 service 디렉토리 밑에 작성하였다.
* 다른 곳에서 메소드를 호출하기 위해 `export default` 처리하였다.

## 0407
# mongoDB 소개
## Document Database
* 문서 지향 데이터베이스이다.
```json
// field: value
{
	name: "sue",
	age: 26,
	status: "A",
	groups: [ "news", "sports" ]
}
```

### 장점
* 문서는 많은 프로그래밍 언어 (ex 자바스크립트)에서 기본 데이터 타입으로 제공한다.
* 내장된 문서(json 안에 json)와 배열은 조인의 필요성을 줄인다.
* polymorphism 구현에 유리하도록 동적 스키마를 제공한다.

### 컬렉션/뷰/On-Demand Materialized Views
* 몽고DB는 문서를 컬렉션에 저장한다.
* 컬렉션은 관계 DB의 테이블과 같은 역할을 한다.

* 컬렉션에서 몽고DB 지원:
	* 읽기 전용 뷰
	* 실체화된 뷰

## 몽고DB 주요 특징
### 고성능
* 임베디드 데이터 모델을 지원해서 입출력에 관한 부담을 줄인다.
* 인덱스는 빠른 속도의 쿼리를 지원한다.

### 풍부한 질의어
* 몽고DB는 읽고 쓰기 연산을 지원하기 위해 풍부한 질의어를 제공한다.
	* 데이터 그룹
	* 텍스트 검색, 2차원 3차원 좌표 쿼리

### 가용성
* replica set이라는 복제 기능을 제공한다. 
	* 자동 복구
	* 데이터 중복성
* replica set은 몽고DB 서버의 그룹으로 같은 데이터를 유지하고, 중복성을 제공하여 데이터 가용성을 높인다.

### 수평적 확장성
* 몽고DB는 핵심 기능 중 하나로 수평적 확장성을 제공한다.
	* Sharding

### 다수의 Storage Engines을 제공
* WiredTiger Storage Engine
* In-Memory Storage Engine
* 추가적으로, 몽고DB는 써드파티 storage engines을 허용하는 API를 제공한다.